<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="HVAC Template">
    <meta name="keywords" content="HVAC, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AutoArena | Cadastro de Estados</title>

    <div th:replace="~{fragments/privateCSS :: privateCss}"></div>


</head>

<body>


<!-- WRAPPER -->
<div id="wrapper">

    <div th:replace="~{fragments/privateHeader :: headerFragment}"></div>

    <div th:replace="~{fragments/privateLeftMenu :: leftMenuFragment}"></div>


    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <!--<h3 class="page-title">Page Header | Title</h3>-->
                <h3 class="page-title"><p th:text="${pageTitle}"></p></h3>

                <div class="panel panel-headline demo-icons">

                    <div class="panel-body">

                        <form th:action="@{/private/cadastro/estado/registro}" method="post">

                            <input type="hidden" id="estadoId" name="id" value="">


                            <div class="form-group col-md-4">
                                <label for="selectPais">País</label>
                                <select class="form-control" id="selectPais" name="selectPais" required>
                                    <option value="">-- Selecione um País --</option>
                                    <option th:each="pais : ${paises}"
                                            th:value="${pais.id}"
                                            th:text="${pais.nome}">
                                        Nome do País
                                    </option>
                                </select>
                            </div>

                            <div class="form-group col-md-4">
                                <label for="txtNome" class="control-label">Nome</label>
                                <input id="txtNome" name="txtNome" type="text" class="form-control" placeholder="Digite o nome do estado" required>
                            </div>

                            <div class="form-group  col-md-2">
                                <label for="txtUf">UF</label>
                                <input type="text" class="form-control" id="txtUf" name="txtUf" placeholder="Digite a UF" maxlength="2" required>
                            </div>

                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                            <div class="form-group col-md-12">
                                <button type="submit" class="btn btn-default" id="submitButton">Salvar</button>
                                <button type="button" class="btn btn-default" id="cancelButton" style="display: none;">Cancelar</button>
                            </div>


                        </form>
                    </div>
                </div>

                <div class="panel panel-headline demo-icons">
                    <!--
                    <div class="panel-heading">
                        <h4 class="panel-title" th:text="${blockTitle}"></h4>
                        <p class="panel-subtitle" th:text="${blockSubtitle}"></p>
                    </div>
                    -->
                    <div class="panel-body">

                        <h4 class="panel-title" th:text="Filtros"></h4>

                        <hr>
                        <form method="get" th:action="@{/private/cadastro/estado}">
                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="filtroPaisId">País</label>
                                    <select id="filtroPaisId" name="paisId" class="form-control">
                                        <option value="">Todos</option>
                                        <option th:each="pais : ${paises}"
                                                th:value="${pais.id}"
                                                th:text="${pais.nome}"
                                                th:selected="${filtroPaisId != null and filtroPaisId == pais.id}">
                                        </option>
                                    </select>
                                </div>

                                <div class="form-group col-md-4">
                                    <label for="filtroNome">Nome</label>
                                    <input type="text" id="filtroNome" name="nome" class="form-control" th:value="${filtroNome}" placeholder="Nome do Estado">
                                </div>
                                <div class="form-group col-md-2">
                                    <label for="filtroOrdenacao">Ordenar por</label>
                                    <select id="filtroOrdenacao" name="sort" class="form-control">
                                        <option value="nome,asc" th:selected="${sort != null and sort == 'nome,asc'}">Nome (A-Z)</option>
                                        <option value="nome,desc" th:selected="${sort != null and sort == 'nome,desc'}">Nome (Z-A)</option>
                                        <option value="id,asc" th:selected="${sort != null and sort == 'id,asc'}">ID (Crescente)</option>
                                        <option value="id,desc" th:selected="${sort != null and sort == 'id,desc'}">ID (Decrescente)</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-2">
                                    <label for="filtroTamanho">Exibir Itens por página</label>
                                    <select id="filtroTamanho" name="size" class="form-control">
                                        <option value="5" th:selected="${size == 5}">5</option>
                                        <option value="10" th:selected="${size == 10}">10</option>
                                        <option value="15" th:selected="${size == 15}">15</option>
                                        <option value="20" th:selected="${size == 20}">20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-default">Filtrar e Ordenar</button>
                                <a th:href="@{/private/cadastro/estado}" class="btn btn-default">Limpar Filtros</a>
                            </div>
                        </form>

                        <hr>

                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>UF</th>
                                <th>País</th>
                                <th>Ações</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="estado : ${estados}">
                                <td th:text="${estado.id}">1</td>
                                <td th:text="${estado.nome}">Nome do Estado Exemplo</td>
                                <td th:text="${estado.uf}">UF</td>
                                <td th:text="${estado.pais.nome}">Nome do País Associado</td> <td>
                                <button type="button" class="btn btn-sm btn-info edit-estado-btn"
                                        th:data-id="${estado.id}"
                                        th:data-nome="${estado.nome}"
                                        th:data-uf="${estado.uf}"
                                        th:data-pais-id="${estado.pais.id}">
                                    Editar
                                </button>
                                <button type="button" class="btn btn-sm btn-danger delete-estado-btn"
                                        th:data-id="${estado.id}"
                                        th:data-nome="${estado.nome}">
                                    Excluir
                                </button>
                            </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(estados)}">
                                <td colspan="5" class="text-center">Nenhum estado encontrado.</td>
                            </tr>
                            </tbody>
                        </table>

                    </div>


                    <div th:if="${page.totalPages > 0}" class="text-center">
                        <ul class="pagination">
                            <li th:class="${page.first ? 'disabled' : ''}">
                                <a th:href="@{/private/cadastro/estado(page=${0}, size=${size}, sort=${sort}, nome=${filtroNome}, paisId=${filtroPaisId})}">&laquo;</a>
                            </li>
                            <li th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}" th:class="${page.number == i ? 'active' : ''}">
                                <a th:href="@{/private/cadastro/estado(page=${i}, size=${size}, sort=${sort}, nome=${filtroNome}, paisId=${filtroPaisId})}" th:text="${i + 1}"></a>
                            </li>
                            <li th:class="${page.last ? 'disabled' : ''}">
                                <a th:href="@{/private/cadastro/estado(page=${page.totalPages - 1}, size=${size}, sort=${sort}, nome=${filtroNome}, paisId=${filtroPaisId})}">&raquo;</a>
                            </li>
                        </ul>
                    </div>

                </div>

            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->


    <div th:replace="~{fragments/privateFooter :: footerFragment}"></div>
</div>


<!-- END WRAPPER -->

<div th:replace="~{fragments/privateScriptsJS :: privateScriptsJs}"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function() {

        // Listener para os botões "Editar"
        $('.edit-estado-btn').on('click', function() {
            var id = $(this).data('id');
            var nome = $(this).data('nome');
            var uf = $(this).data('uf');
            var paisId = $(this).data('pais-id');

            // Preenche o formulário
            $('#estadoId').val(id);
            $('#txtNome').val(nome);
            $('#txtUf').val(uf);
            $('#selectPais').val(paisId); // Seleciona a opção correta no dropdown

            // Altera o título do formulário e o texto do botão de submissão
            //$('#formTitle').text('Editar Estado');
            //$('#submitButton').text('Atualizar Estado');
            $('#cancelButton').show(); // Mostra o botão de cancelar

            // Opcional: Rola a página para o formulário
            $('html, body').animate({
                scrollTop: $('#estadoForm').offset().top - 100
            }, 500);
        });

        // Listener para o botão "Cancelar Edição"
        $('#cancelButton').on('click', function() {
            // Limpa o formulário
            $('#estadoId').val('');
            $('#txtNome').val('');
            $('#txtUf').val('');
            $('#selectPais').val(''); // Limpa a seleção do dropdown

            // Restaura o título do formulário e o texto do botão de submissão
            //$('#formTitle').text('Cadastrar Novo Estado');
            //$('#submitButton').text('Salvar Estado');
            $('#cancelButton').hide(); // Esconde o botão de cancelar
        });

        // Listener para os botões "Excluir" (usando confirmação nativa)
        $('.delete-estado-btn').on('click', function() {
            var id = $(this).data('id');
            var nome = $(this).data('nome');

            var confirmDelete = confirm("Tem certeza que deseja excluir o estado '" + nome + "'?");

            if (confirmDelete) {
                // Cria um formulário dinamicamente
                var form = $('<form>', {
                    'action': '/private/cadastro/estado/excluir',
                    'method': 'post',
                    'style': 'display:none;'
                });

                // Adiciona o campo ID
                $('<input>', {
                    'type': 'hidden',
                    'name': 'id',
                    'value': id
                }).appendTo(form);

                // Adiciona o token CSRF
                if ($('input[name="_csrf"]').length > 0) {
                     $('<input>', {
                        'type': 'hidden',
                        'name': $('input[name="_csrf"]').attr('name'),
                        'value': $('input[name="_csrf"]').val()
                    }).appendTo(form);
                }

                // Adiciona o formulário ao body e o submete
                form.appendTo('body').submit();
            }
        });

    });
    /*]]>*/
</script>

</body>

</html>